<!DOCTYPE html>
<html>
<head>
    <title>צפייה/הוספה יחידות ארגוניות</title>

    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">

    <link href="../Style.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <meta charset="utf-8" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script type="text/javascript"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script>
        var myData;
        var ApartmentTypeA;
        ApartmentTypeA = [];
        id = 1;
        $(document).ready(function () {
            $("#cancelSaveBTN").on("click", function () {
                $("#editDiv").hide();
            });
            ajaxCall("GET", "../api/OrganizeUnit", "", getSuccess, error);
            ajaxCall("GET", "../api/ApartmentType", "", GetTypeS, GetTypeE);
            $("#editDiv").hide();
        });
        function markSelected(btn) {
            $("#UnitTable tr").removeClass("selected");
            row = (btn.parentNode).parentNode;
            row.className = 'selected';
        }
        function getSuccess(data) {
            myData = data;
            try {
                tbl = $('#UnitTable').DataTable({
                    data: data,
                    columns: [
                        { data: "Unitname" },
                        { data: "City" },
                        { data: "Street_hnumber" },
                        { data: "Numofguides" },
                        { data: "Numofresidents" },
                        {
                            data: "ApartmentType1",
                            render: function (data, type, row, meta) {
                                if (data == 0) {
                                    return "הוסטל";
                                }
                                for (var i = 0; i < ApartmentTypeA.length; i++) {
                                    if (data == ApartmentTypeA[i].Id) {
                                        return "דירה " + ApartmentTypeA[i].Apartmenttype.toString();
                                    }
                                }
                            }
                        },
                    ],
                });
            }

            catch (err) {
                alert(err);
            }
        }
        function error(err) {
            swal("Error: " + err);
        }
        function validateForm() {
            var Uname = document.forms["myForm"]["name1"].value;
            var Ucity = document.forms["myForm"]["city1"].value;
            var Ustreet = document.forms["myForm"]["street1"].value;
            var Unumber = document.forms["myForm"]["number1"].value;
            var GuideNum = document.forms["myForm"]["UGuideNum1"].value;
            var UResNum = document.forms["myForm"]["UResNum1"].value;
            var SUnitType = document.forms["myForm"]["SUnitType1"].value;
            if (Uname == "") {
                alert("חובה למלא שדה שם יחידה");
                return;
            }
            if (Ucity == "") {
                alert("חובה למלא שדה עיר");
                return;
            }
            if (Ustreet == "") {
                alert("חובה למלא שדה רחוב");
                return;
            }
            else if (Unumber == "") {
                alert("חובה למלא שדה מספר בית");
                return;
            }
            if (GuideNum == "") {
                alert("חובה למלא שדה מספר מדריכים");
                return;
            }
            if (UResNum == "") {
                alert("חובה למלא שדה מספר דיירים");
                return;
            }
            if (SUnitType == "") {
                alert("חובה למלא שדה סוג דירה");
                return;
            }
            else {
                alert("goodddd");
                InsertUnit();
                return false;
            }
        }
        function InsertUnit() {
            name = $("#name").val();
            for (var i = 0; i < myData.length; i++) {
                if (myData[i].Unitname == name) {
                    //Swal('כבר קיימת יחידה ארגונית במערכת בשם זה', '', 'error');
                    alert("כבר קיימת יחידה ארגונית במערכת בשם זה");
                    return;
                }
            }
            Numofresidents = $("#numofresidents").val();
            Numofguides = $("#numofguides").val();
            City = $("#city").val();
            Street_hnumber = $("#street").val() + " " + $("#Hnum").val();
            Unittype = $("#unittype").val();
            if (Unittype == "דירה") {
                for (var i = 0; i < ApartmentTypeA.length; i++) {
                    if ($("#TypeOfApartment").val() == ApartmentTypeA[i].Apartmenttype)
                        id = ApartmentTypeA[i].Id;
                }
            }


            Unit = {
                "Unitname": name,
                "Numofresidents": Numofresidents,
                "Numofguides": Numofguides,
                "City": City,
                "Street_hnumber": Street_hnumber,
                "Unittype": Unittype,
                "ApartmentType1": id,
            }


            ajaxCall("POST", "../api/OrganizeUnit", JSON.stringify(Unit), PostUnitS, PostUnitE);


        }
        function PostUnitS(data) {
            alert("goood!");
            return false;
        }
        function PostUnitE(error) {
            console.log(error);
            return false;
        }
        function GetApartmentType() {
            Unittype = $("#unittype").val();
            if (Unittype == "דירה") {
                //ajaxCall("GET", "../api/ApartmentType", "", GetTypeS, GetTypeE);
                str = "<select id='TypeOfApartment' ><option > בחר סוג דירה</option>"
                for (var i = 0; i < ApartmentTypeA.length; i++) {
                    str += "<option id='" + ApartmentTypeA[i].Id + "'> " + ApartmentTypeA[i].Apartmenttype + "</option >";
                }
                str += "</select > ";
                $("#apartmenttype").html(str);
            }
            else $("#apartmenttype").html("");


        }
        function GetTypeS(data) {
            ApartmentTypeA = data;
        }
        function GetTypeE(error) {
            console.log(error);
        }
    </script>

</head>
<body dir="rtl" style="background-color:aliceblue">
    <img src="../Photos/LOGO.PNG" />
    <div class="container">

        <br />
        <br />
        <h1>צפייה ביחידות ארגוניות </h1>
        <br />
        <br />
        <form id="pForm">
            <p class="expl">בטבלה שלהלן מוצגות כל היחידות הארגוניות.</p>
            <br />
            <table id="UnitTable" class="display nowrap" style="width:50%">
                <thead>
                    <tr>
                        <th>שם היחידה</th>
                        <th>עיר</th>
                        <th>רחוב ומספר</th>
                        <th>מספר מדריכים</th>
                        <th>מספר דיירים</th>
                        <th>סוג יחידה</th>
                    </tr>
                </thead>
            </table>
        </form>
        <br />
        <br />


        <h1>  הוספת יחידה ארגונית חדשה</h1><br />
        <p class="expl">על מנת להוסיף יחידה ארגונית חדשה, יש למלא את פרטיה ולבסוף ללחוץ על כפתור "שמור".</p>

        <div class="row">

            <form dir="rtl" name="myForm" action="/action_page.php" onsubmit="return validateForm()" method="post">
                <div class="col" id="insertUnit">

                    <span>שם היחידה: </span><input type="text" id="name" name="name1" required /><br />
                    <span>עיר: </span><input type="text" id="city" name="city1" required /><br />
                    <span> רחוב:</span><input type="text" id="street" name="street1" required /> <br />
                    <span> מספר:</span><input type="number" id="Hnum" required name="number1" /><br />
                    <span> מספר מדריכים:</span><input type="text" id="numofguides" required name="UGuideNum1" /><br />
                    <span> מספר דיירים:</span><input type="text" id="numofresidents" required name="UResNum1" /><br />
                    <span>סוג:</span><select id="unittype" onchange="GetApartmentType()" required name="SUnitType1">
                        <option value=""> בחר סוג יחידה ארגונית</option>
                        <option value="דירה"> דירה</option>
                        <option value="הוסטל"> הוסטל</option>
                    </select><br /><div id="apartmenttype">

                    </div>

                </div>
                <!--<br /><input type="submit" value="שמור" onclick="InsertUnit()" /><br />-->
                <br /><input type="submit" value="שמור" /><br />

            </form>

        </div>
    </div>
</body>
</html>
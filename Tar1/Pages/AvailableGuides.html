<!DOCTYPE html>
<html>
<head>
    <link href="../Style.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <meta charset="utf-8" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>
    <script type="text/javascript"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <script src="../Scripts/moment.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
    <script src="sweetalert2/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.js"></script>
    <script src="sweetalert2/dist/sweetalert2.min.js"></script>
    <link rel="stylesheet" href="sweetalert2/dist/sweetalert2.min.css">
    <title>רשימת מדריכים פנויים לאיוש משמרות</title>
    <script>
        unit = 0;
        ShiftsArray = [];

        function gets() {
            ajaxCall("GET", "../api/OrganizeUnit", "", GetOrganizeUnitS, error);
        }
        function GetOrganizeUnitS(data) {
            str = "<option>בחר יחידה ארגונית</option>";
            for (var i = 0; i < data.length; i++) {
                str += "<option value='" + data[i].Id + "'>" + data[i].Unitname + "</option>"
            }
            $("#SelectUnit").html(str);
        }
        function error(err) {
            console.log(err);
        }
        function GetWorkSchedule(select) {
            id = select.options[select.selectedIndex].value;
            unit = id.toString();
            ajaxCall("GET", "../api/Period/Id?id=" + unit, "", GETPeriodsS, error);

        }
        function GETPeriodsS(data) {

            str = "<option value=''> בחר תקופת שיבוץ</option>";
            for (var i = 0; i < data.length; i++) {
                end = data[i].Enddate.split("T");
                start = data[i].Startdate.split("T");
                Speriod = moment(start[0]);
                Eperiod = moment(end[0]);
                str = str + "<option value='" + Speriod.format("YYYY-MM-DD") + "|" + Eperiod.format("YYYY-MM-DD") + "'>" + Eperiod.format('DD/MM/YYYY') + " - " + Speriod.format('DD/MM/YYYY') + "</option>";
            }
            $("#period").html(str);

            $("#Emptyperiod").show();
        }
        function getshifts(select) {
            id = select.options[select.selectedIndex].value;
            mahrozet = id.toString() + "|" + unit.toString();
            ajaxCall("GET", "../api/Official/Unit?mahrozet=" + mahrozet, "", GETOfficialS, error);

        }
        function GETOfficialS(data) {
            for (var i = 0; i < data.length; i++) {
                d = data[i].Shiftdate.split("T");
                x = data[i].Startshifthour.split("T");
                y = data[i].Endshifthour.split("T");
                shiftdatestart = d[0] + " " + x[1];
                shiftdateend = d[0] + " " + y[1];
                shift = {
                    "Type": data[i].Shifttype,
                    "StartShift": moment(shiftdatestart),
                    "EndShift": moment(shiftdateend),
                }
                ShiftsArray.push(shift);
            }
            ShiftsArray.sort(sortByDateAsc);
            str = "<option value=''> בחר משמרת</option>";
            for (var i = 0; i < ShiftsArray.length; i++) {
                YomBa = ShiftsArray[i].StartShift.day();
                yom = "";
                yom = TellMeTheDay(YomBa);
                str += "<option id='" + i + "' value='" + ShiftsArray[i].StartShift.format("YYYY-MM-DD") + "|" + ShiftsArray[i].Type + "'>" + ShiftsArray[i].StartShift.format('DD/MM/YYYY') + " " + yom + " " + ShiftsArray[i].Type + " </option>"
            }
            $("#emptyshifts").show();
            $("#shifts").html(str);
        }
        function checkGuides(select) {
            shift = select.options[select.selectedIndex].value;
            ajaxCall("GET", "../api/User/" + shift, "", SuccessUser, error);
        }
        function TellMeTheDay(YomBa) {
            switch (YomBa) {
                case 0:
                    return 'יום ראשון';
                    break;
                case 1:
                    return 'יום שני';
                    break;
                case 2:
                    return 'יום שלישי';
                    break;
                case 3:
                    return 'יום רביעי';
                    break;
                case 4:
                    return 'יום חמישי';
                    break;
                case 5:
                    return 'יום שישי ';
                    break;
                case 6:
                    return 'יום שבת';
                    break;
                default:
                    break;
            }
        }
        function SuccessUser(data) {
            console.log(data);
            $("#guidestbl").show();
            try {
                tbl = $('#GTable').DataTable({
                    data: data,
                    columns: [
                        { data: "Firstname" },
                        { data: "Password" },
                        { data: "Telephone" },
                        {
                            data: "MonthlyHours",
                            render: function (data, type, row, meta) {
                                return data.toFixed(2);
                            }
                        },
                        {
                            data: "MonthlyExtraHours",
                            render: function (data, type, row, meta) {
                                return data.toFixed(2);
                            }
                        },
                        {
                            data: "Weeklyhours",
                            render: function (data, type, row, meta) {
                                return data.toFixed(2);
                            }
                        },
                        { data: "Role" },
                        {
                            render: function (data, type, row, meta) {

                                editBtn = "<button  id='" + row.Userid + "' class = 'editBtn btn btn-success' onclick='CheckGuide(this," + row.MonthlyExtraHours + "," + row.Weeklyhours + "," + row.MonthlyHours + ")'> שבץ מדריך </button>";
                                return editBtn;
                            }
                        },
                    ],
                });
            }

            catch (err) {
                alert(err);
            }
        }
        sortByDateAsc = function (lhs, rhs) { return lhs.StartShift > rhs.StartShift ? 1 : lhs.StartShift < rhs.StartShift ? -1 : 0 }
        function CheckGuide(button, extre, weekly, monthly) {
            console.log(button, extre, weekly, monthly);
         Swal.fire({
  title: 'Are you sure?',
  text: "You won't be able to revert this!",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes, delete it!'
}).then((result) => {
  if (result.value) {
    Swal.fire(
      'Deleted!',
      'Your file has been deleted.',
      'success'
    )
  }
})
        }
    </script>
</head>
<body dir="rtl" style="background-color:aliceblue" onload="gets()">

    <img src="../Photos/LOGO.PNG" />
    <div class="container-fluid" id="SubmShift">

        <h1> איוש מדריכים למשמרות</h1><br />
        <div class="row">
            <h3> בחר יחידה ארגונית שברצונך לאייש עבורה משמרת  </h3>
            <select id="SelectUnit" onchange="GetWorkSchedule(this)"></select>

        </div>
        <div id="Emptyperiod" style="display:none">
            <span>בחר מהרשימה תקופת שיבוץ </span>

            <select id="period" onchange="getshifts(this)"> </select><br />
        </div><div id="emptyshifts" style="display:none">
            <span>בחר מהרשימה משמרת </span>
            <select id="shifts" onchange="checkGuides(this)"> </select>
        </div>

        <div id="guidestbl" style="display:none">
   
                <table id="GTable" class="display nowrap">
                    <thead>
                        <tr>
                            <th>שם המדריך</th>
                            <th>יחידה ארגונית</th>
                            <th>טלפון </th>
                            <th>מספר שעות חודשיות</th>
                            <th>מספר שעות נוספות חודשיות</th>
                            <th>מספר שעות שבועיות</th>
                            <th>רמת הכשרה</th>
                            <th>שיבוץ מדריך</th>
                        </tr>
                    </thead>
                </table>

        </div>


        <br /><br />


    </div>
</body>
</html>
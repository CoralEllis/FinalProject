<!DOCTYPE html>
<html>
<head>
    <link href="../Style.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <meta charset="utf-8" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <script type="text/javascript"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src="../Scripts/moment.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment-range/4.0.1/moment-range.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        select, div {
            font-family: fontAwesome
        }
    </style>
    <script>
        ShiftsArray = [];
        GuidesPref = [];
        OfficialShifts = [];
        Guides = [];
        Exceptions = [];
        OldExceptions = [];
        calendar = [];
        CheckEightHours = false;
        MaxRestHours = 0;// the rest hours that worker need to get evry week
        LongerShift = 0;// max duration of shift
        MonthNormalHours = 0;//hours per month
        ExtraHours = 0;//extra hours per month
        HoursPerWeek = 0;//number of hours that worker can work in 1 week
        HoursBetweenShifts = 0;//min number of that worker need to get between 2 shifts
        Preperness = false;
        Regularshifthours = 0.0;
        SNightShiftHours = 0;
        again = false;
        SaveShifts = [];
        var user;
        Unitid = 0;
        window['moment-range'].extendMoment(moment);
        function GetPreperness() {

            ajaxCall("GET", "../api/Period/" + Unitid, "", GETPrepernessS, GETPrepernessE);
        }
        function GETPrepernessS(data) {
            Preperness = data;
        }
        function GETPrepernessE(error) {
            console.log(error);
        }
        function GetSHifts() {
            user = JSON.parse(localStorage.getItem("User"));
            //Unitid = user.Unitid;
            Unitid = 2;
            ajaxCall("GET", "../api/Shifts/" + Unitid, "", GETShiftS, GETShiftE);
            GetPreperness();
        }
        function GETShiftS(data) {
            if (data.length == 0) {
                str = "אין משמרות ותקופת שיבוץ עתידיים";
                $("#submitshift").html(str);
                return null;
            }
            for (var i = 0; i < data.length; i++) {
                d = data[i].Shiftdate.split("T");
                x = data[i].Start.split("T");
                y = data[i].End.split("T");
                shiftdatestart = d[0] + " " + x[1];
                shiftdateend = d[0] + " " + y[1];
                shift = {
                    "Type": data[i].Type,
                    "StartShift": moment(shiftdatestart),
                    "EndShift": moment(shiftdateend),
                    "Guidenum": data[i].GuideNum1,
                    "NuminOfficialShift": [],
                    "NuminSaveShift": []
                }
                ShiftsArray.push(shift);
            }
            ShiftsArray.sort(sortByDateAsc);
            str = "";
            for (var i = 0; i < ShiftsArray.length; i++) {
                datestr = ShiftsArray[i].StartShift.format('DD/MM/YYYY');
                str = "<div class='row shiftsShow' id='" + ShiftsArray[i].StartShift.format("YYYY-MM-DD") + "|" + ShiftsArray[i].Type + "'  onclick='showBigShift(this," + i + ")'><p>" + ShiftsArray[i].Type + "<br />" + datestr + "<br />" + ShiftsArray[i].EndShift.format('HH:mm') + " - " + ShiftsArray[i].StartShift.format('HH:mm') + "<br />מספר מדריכים:" + ShiftsArray[i].Guidenum + "<br />מדריכים משובצים:</p></div><br />";
                shiftd = ShiftsArray[i].StartShift.day();
                switch (shiftd) {
                    case shiftd:
                        document.getElementById(shiftd).innerHTML += str;
                        break;
                    default:
                        break;
                }
            }
            ajaxCall("GET", "../api/Official/Unit/" + Unitid, "", GETOfficialS, GETOfficialE);
            ajaxCall("GET", "../api/ApplyShift/" + Unitid, "", GETGuidePrefS, GETGuidePrefE);
        }
        function GETOfficialS(data) {
            if (data.length != 0)
                again = true;
            for (var i = 0; i < data.length; i++) {
                d = data[i].Shiftdate.split("T");
                x = data[i].Startshifthour.split("T");
                y = data[i].Endshifthour.split("T");
                shiftdatestart = d[0] + " " + x[1];
                shiftdateend = d[0] + " " + y[1];
                User = data[i].Userid.split(",");
                SaveShift = {
                    "Userid": User[0],
                    "Startshifthour": moment(shiftdatestart).format("HH:mm"),
                    "Endshifthour": moment(shiftdateend).format("HH:mm"),
                    "Unitid": data[i].Unitid,
                    "Shifttype": data[i].Shifttype,
                    "Shiftdate": moment(shiftdatestart).format("YYYY-MM-DD"),
                    "UserName": User[1],
                    "Done": false,
                    "StartShift": moment(shiftdatestart)
                }
                SaveShifts.push(SaveShift);
            }
            SaveShifts.sort(sortByDateAsc);
        }
        function GETOfficialE(err) {
            console.log(err);
        }
        function GETShiftE(error) {
            swal("ישנה בעיה בטעינת המשמרות", "אנא נסה לטעון את העמוד מחדש", "warning");
            console.log(error);
        }
        function GETGuidePrefS(data) {
            GuidesPref = data;
            loop1:
            for (var i = 0; i < ShiftsArray.length; i++) {
                if (ShiftsArray[i].Guidenum != 1) {
                    count = 0;
                    rf = "";
                    loop2:
                    for (var j = 0; j < ShiftsArray[i].Guidenum; j++) {
                        loop3:
                        for (var a = 0; a < SaveShifts.length; a++) {
                            if (ShiftsArray[i].Type == SaveShifts[a].Shifttype && ShiftsArray[i].StartShift.format("YYYY-MM-DD") == SaveShifts[a].Shiftdate) {
                                ShiftsArray[i].NuminSaveShift.push(a);
                                if (SaveShifts[a].Done == true)
                                    continue loop3;
                                else if (SaveShifts[a].Userid != "666666666" && SaveShifts[a].Userid != "777777777" && SaveShifts[a].Userid != "888888888" && SaveShifts[a].Userid != "999999999") {
                                    count += 1;
                                    SaveShifts[a].Done = true;
                                    OfficialShift = {
                                        "Userid": SaveShifts[a].Userid,
                                        "Startshifthour": SaveShifts[a].Startshifthour,
                                        "Endshifthour": SaveShifts[a].Endshifthour,
                                        "Unitid": SaveShifts[a].Unitid,
                                        "Shifttype": SaveShifts[a].Shifttype,
                                        "Shiftdate": SaveShifts[a].Shiftdate
                                    }
                                    OfficialShifts.push(OfficialShift);
                                    s = OfficialShifts.length - 1;
                                    MultipleGuides = {
                                        "NumInArray": s,
                                        "Occupied": true
                                    }
                                    ShiftsArray[i].NuminOfficialShift.push(MultipleGuides);
                                    rf = SaveShifts[a].Shiftdate + "|" + SaveShifts[a].Shifttype;
                                    document.getElementById(rf).childNodes[0].innerHTML += "<span id='" + SaveShifts[a].Userid + "embed" + rf + "' class='row' style='margin:auto'>" + SaveShifts[a].UserName + "</span>";
                                    continue loop2;
                                }
                                else if (SaveShifts[a].Userid == "666666666" || SaveShifts[a].Userid == "777777777" || SaveShifts[a].Userid == "888888888" || SaveShifts[a].Userid == "999999999") {
                                    SaveShifts[a].Done = true;
                                    OfficialShift = {
                                        "Userid": SaveShifts[a].Userid,
                                        "Startshifthour": SaveShifts[a].Startshifthour,
                                        "Endshifthour": SaveShifts[a].Endshifthour,
                                        "Unitid": SaveShifts[a].Unitid,
                                        "Shifttype": SaveShifts[a].Shifttype,
                                        "Shiftdate": SaveShifts[a].Shiftdate
                                    }
                                    OfficialShifts.push(OfficialShift);
                                    s = OfficialShifts.length - 1;
                                    MultipleGuides = {
                                        "NumInArray": s,
                                        "Occupied": true
                                    }
                                    ShiftsArray[i].NuminOfficialShift.push(MultipleGuides);
                                    rf = SaveShifts[a].Shiftdate + "|" + SaveShifts[a].Shifttype;
                                    document.getElementById(rf).childNodes[0].innerHTML += "<span id='" + SaveShifts[a].Userid + "embed" + rf + "' class='row' style='margin:auto'>מדריך חוץ</span>";
                                    continue loop2;
                                }
                            }
                        }
                        OfficialShift = {
                            "Userid": " ",
                            "Startshifthour": ShiftsArray[i].StartShift.format("HH:mm"),
                            "Endshifthour": ShiftsArray[i].EndShift.format("HH:mm"),
                            "Unitid": Unitid,
                            "Shifttype": ShiftsArray[i].Type,
                            "Shiftdate": ShiftsArray[i].StartShift.format("YYYY-MM-DD")
                        }
                        OfficialShifts.push(OfficialShift);
                        s = OfficialShifts.length - 1;
                        MultipleGuides = {
                            "NumInArray": s,
                            "Occupied": false
                        }
                        ShiftsArray[i].NuminOfficialShift.push(MultipleGuides);
                        continue loop2;
                    }
                    if (count == ShiftsArray[i].Guidenum) {
                        document.getElementById(rf).style.backgroundColor = "#CCFFCC";
                        document.getElementById(rf).innerHTML += "<i class='fa fa-thumbs-up' style='font-size:36px; margin:auto'></i>";
                    }

                }
                else {
                    loop2:
                    for (var a = 0; a < SaveShifts.length; a++) {
                        if (ShiftsArray[i].Type == SaveShifts[a].Shifttype && ShiftsArray[i].StartShift.format("YYYY-MM-DD") == SaveShifts[a].Shiftdate) {
                            if (SaveShifts[a].Userid != "666666666" && SaveShifts[a].Userid != "777777777" && SaveShifts[a].Userid != "888888888" && SaveShifts[a].Userid != "999999999") {
                                OfficialShift = {
                                    "Userid": SaveShifts[a].Userid,
                                    "Startshifthour": SaveShifts[a].Startshifthour,
                                    "Endshifthour": SaveShifts[a].Endshifthour,
                                    "Unitid": SaveShifts[a].Unitid,
                                    "Shifttype": SaveShifts[a].Shifttype,
                                    "Shiftdate": SaveShifts[a].Shiftdate
                                }
                                OfficialShifts.push(OfficialShift);
                                s = OfficialShifts.length - 1;
                                MultipleGuides = {
                                    "NumInArray": s,
                                    "Occupied": true
                                }
                                ShiftsArray[i].NuminOfficialShift.push(MultipleGuides);
                                rf = SaveShifts[a].Shiftdate + "|" + SaveShifts[a].Shifttype;
                                document.getElementById(rf).childNodes[0].innerHTML += "<span id='" + SaveShifts[a].Userid + "embed" + rf + "' class='row' style='margin:auto'>" + SaveShifts[a].UserName + "</span>";
                                document.getElementById(rf).style.backgroundColor = "#CCFFCC";
                                document.getElementById(rf).innerHTML += "<i class='fa fa-thumbs-up' style='font-size:36px; margin:auto'></i>";
                                continue loop1;
                            }
                            else if (SaveShifts[a].Userid == "666666666" || SaveShifts[a].Userid == "777777777" || SaveShifts[a].Userid == "888888888" || SaveShifts[a].Userid == "999999999") {
                                OfficialShift = {
                                    "Userid": SaveShifts[a].Userid,
                                    "Startshifthour": SaveShifts[a].Startshifthour,
                                    "Endshifthour": SaveShifts[a].Endshifthour,
                                    "Unitid": SaveShifts[a].Unitid,
                                    "Shifttype": SaveShifts[a].Shifttype,
                                    "Shiftdate": SaveShifts[a].Shiftdate
                                }
                                OfficialShifts.push(OfficialShift);
                                s = OfficialShifts.length - 1;
                                MultipleGuides = {
                                    "NumInArray": s,
                                    "Occupied": true
                                }
                                ShiftsArray[i].NuminOfficialShift.push(MultipleGuides);
                                rf = SaveShifts[a].Shiftdate + "|" + SaveShifts[a].Shifttype;
                                document.getElementById(rf).childNodes[0].innerHTML += "<span id='" + SaveShifts[a].Userid + "embed" + rf + "' class='row' style='margin:auto'>מדריך חוץ</span>";
                                continue loop1;
                            }
                        }
                    }
                    OfficialShift = {
                        "Userid": " ",
                        "Startshifthour": ShiftsArray[i].StartShift.format("HH:mm"),
                        "Endshifthour": ShiftsArray[i].EndShift.format("HH:mm"),
                        "Unitid": Unitid,
                        "Shifttype": ShiftsArray[i].Type,
                        "Shiftdate": ShiftsArray[i].StartShift.format("YYYY-MM-DD")
                    }
                    OfficialShifts.push(OfficialShift);
                    s = OfficialShifts.length - 1;
                    MultipleGuides = {
                        "NumInArray": s,
                        "Occupied": false
                    }
                    ShiftsArray[i].NuminOfficialShift.push(MultipleGuides);
                    continue loop1;
                }
                temp = 0;
                if (CheckEightHours == false && ShiftsArray[i].Type == "לילה") {
                    CheckEightHours = true;
                }
                else if (CheckEightHours == false && ShiftsArray[i].Type == "ערב" && i + 1 < ShiftsArray.length) {
                    Mend = moment(ShiftsArray[i].End, 'HH:mm A');
                    Mstart = moment(ShiftsArray[i + 1].Start, 'HH:mm A');
                    milisecond = moment.duration(Mstart.diff(Mend));
                    temp = milisecond.asHours();
                    if (temp <= HoursBetweenShifts) {
                        CheckEightHours = true;
                    }
                }
            }
            SetWeeks();
        }
        function GETGuidePrefE(error) {
            swal("ישנה בעיה", "אנא נסה לטעון את העמוד מחדש", "warning");
            console.log(error);
        }
        function GETGuideS(data) {
            ExtraDiv = "<p> שעות נוספות</p>" + "<br /><br />";

            for (var i = 0; i < data.length; i++) {
                Guide = {
                    "UserId": data[i].Userid,
                    "Username": data[i].Firstname + " " + data[i].Lastname,
                    "MonthlyNormalHours": data[i].MonthlyHours,
                    "MonthlyExtraHours": data[i].MonthlyExtraHours,
                    "WeeklyHours": [],
                    "ShiftsSorted": [],
                    "CountPref": data[i].NumOfPref,
                }
                if (again == true) {
                    for (var d = 0; d < SaveShifts.length; d++) {
                        if (SaveShifts[d].Userid == Guide.UserId) {
                            shiftdatetime = SaveShifts[d].Shiftdate + " " + SaveShifts[d].Startshifthour;
                            Hathala = moment(shiftdatetime);
                            shiftend = SaveShifts[d].Shiftdate + " " + SaveShifts[d].Endshifthour;
                            sium = moment(shiftend);
                            GuideShiftR = {
                                "ShiftDate": SaveShifts[d].Shiftdate,
                                "ShiftType": SaveShifts[d].Shifttype,
                                "StartShift": Hathala,
                                "EndHour": sium
                            }
                            Guide.ShiftsSorted.push(GuideShiftR);
                        }
                    }
                }
                ExtraDiv += "<div id='Extra" + Guide.UserId + "' style='margin:2px'>";
                if (Guide.MonthlyExtraHours != 0) {
                    ExtraDiv += Guide.Username + ": " + Guide.MonthlyExtraHours.toFixed(2) + "   ";
                }
                ExtraDiv += "</div>";
                for (var j = 0; j < calendar.length; j++) {
                    if (j == 0)
                        Guide.WeeklyHours.push(data[i].Weeklyhours);
                    else
                        Guide.WeeklyHours.push(0);
                }
                Guides.push(Guide);
            }
            $("#ExtraHours").html(ExtraDiv);
            ajaxCall("GET", "../api/Constraint", "", GETConstraintSuccess, GETConstraintError);
        }
        function GETConstraintSuccess(data) {
            HoursPerWeek = data[0].ConstraintValue;
            MonthNormalHours = data[1].ConstraintValue;
            ExtraHours = data[2].ConstraintValue;
            MaxRestHours = data[3].ConstraintValue;
            LongerShift = data[4].ConstraintValue;
            HoursBetweenShifts = data[5].ConstraintValue;
            Regularshifthours = data[6].ConstraintValue;
            SNightShiftHours = data[7].ConstraintValue;
        }
        function GETExceptionS(data) {
            console.log(data);
            OldExceptions = data;
        }
        function GETExceptionE(err) {
            console.log(err);
        }
        function SetWeeks() {
            year = ShiftsArray[0].StartShift.year();
            month = ShiftsArray[ShiftsArray.length - 1].StartShift.month();
            firstDay = moment(ShiftsArray[0].StartShift.format("YYYY-MM-DD"));
            endDay = moment(ShiftsArray[ShiftsArray.length - 1].StartShift.format("YYYY-MM-DD"));
            // Create a range for the month we can iterate through
            monthRange = moment().range(firstDay, endDay);
            // Get all the weeks during the current month
            weeks = [];
            for (let mday of monthRange.by('days')) {
                if (weeks.indexOf(mday.week()) === -1) {
                    weeks.push(mday.week());
                }
            }
            // Create a range for each week
            for (let index = 0; index < weeks.length; index++) {
                var weeknumber = weeks[index];
                firstWeekDay = moment().year(year).month(month).week(weeknumber).day(0);
                lastWeekDay = moment().year(year).month(month).week(weeknumber).day(6);
                if (month == 11 && (weeks.length - 1) == index) {
                    firstWeekDay = moment().year(year).month(month).week(weeks[index - 1]).day(0);
                    firstWeekDay.add(7, "day");
                    lastWeekDay = moment().year(year).month(month).week(weeks[index - 1]).day(6);
                    lastWeekDay.add(6, "day");
                }
                if (firstWeekDay.isBefore(firstDay)) {
                    firstWeekDay = firstDay;
                }

                if (lastWeekDay.isAfter(endDay)) {
                    lastWeekDay = endDay;
                }
                weekRange = moment.range(firstWeekDay, lastWeekDay);
                calendar.push(weekRange);
            }

            unitDate = ShiftsArray[0].StartShift.format("YYYY-MM-DD");
            ajaxCall("GET", "../api/User/WorkUnit?unit=" + Unitid + "&Date=" + unitDate, "", GETGuideS, GETGuideE);
            ajaxCall("GET", "../api/Exception/per?Unit=" + Unitid + "&Date=" + unitDate, "", GETExceptionS, GETExceptionE);
        }
        function GETConstraintError(error) {
            console.log(error);
            swal("ישנה בעיה בטעינת האילוצים", "אנא נסה לטעון את העמוד מחדש", "warning");

        }
        function GETGuideE(error) {
            swal("ישנה בעיה בטעינת המדריכים", "אנא נסה לטעון את העמוד מחדש", "warning");

            console.log(error);
        }
        function TellMeTheDay(YomBa) {
            switch (YomBa) {
                case 0:
                    return 'יום ראשון';
                    break;
                case 1:
                    return 'יום שני';
                    break;
                case 2:
                    return 'יום שלישי';
                    break;
                case 3:
                    return 'יום רביעי';
                    break;
                case 4:
                    return 'יום חמישי';
                    break;
                case 5:
                    return 'יום שישי ';
                    break;
                case 6:
                    return 'יום שבת';
                    break;
                default:
                    break;
            }
        }

        function showBigShift(div, numinarrshift) {
            r = moment(ShiftsArray[numinarrshift].StartShift.format("YYYY-MM-DD"));
            YomBa = r.day();
            yom = "";
            yom = TellMeTheDay(YomBa);
            strshift = $(div).html();
            arrshift = strshift.split("<br>");
            parag = "<div class='" + div.id + "' style='width:500px'>משמרת נוכחית<br />" + yom + " " + arrshift[0] + "<br />" + arrshift[1] + "<br />" + arrshift[2] + "<br />" + arrshift[3] + "<br /> <i class='fas fa-circle' style='color:darkseagreen'></i>";
            parag += "מומלצים לשיבוץ<span>     </span><i class='fas fa-circle' style='color:orangered'></i>לא מומלצים לשיבוץ<span>   </span><br /> ";
            parag += "<select class='selectguides' id='goodGuids' onchange='InsertGuide(this," + numinarrshift + ")'><option value=''>בחר מדריך</option></select><span id='lists'></span><select class='selectguides' id='badGuids' onchange='InsertGuide(this," + numinarrshift + ")'><option value=''>בחר מדריך</option></select>";
            mispar = ShiftsArray[numinarrshift].NuminOfficialShift.length;
            for (var i = 0; i < mispar; i++) {
                if (ShiftsArray[numinarrshift].NuminOfficialShift[i].Occupied == true) {
                    identity = OfficialShifts[ShiftsArray[numinarrshift].NuminOfficialShift[i].NumInArray].Userid;
                    begin = OfficialShifts[ShiftsArray[numinarrshift].NuminOfficialShift[i].NumInArray].Startshifthour;
                    final = OfficialShifts[ShiftsArray[numinarrshift].NuminOfficialShift[i].NumInArray].Endshifthour;
                    name = document.getElementById(identity + "embed" + div.id).innerText;
                    parag += "<div id='div" + identity + " style='font-family: fontAwesome'><br>" + name + "<input type='time' value='" + final + "' id='" + identity + "E' disabled=''>  -  <input type='time' value='" + begin + "' id='" + identity + "S' disabled=''><button id='deleteguidebutton' onclick='SaveUpdateshift(this," + identity + "," + numinarrshift + ")'>מחק מדריך</button></div>";
                }
            }
            parag += "</div>"
            $("#ChoosenShift").html(parag);
            PutGuides(div, numinarrshift);
            $("#before").html(" ");
            $("#after").html(" ");
            //check if the shift is not the last/first in the array
            if (numinarrshift > 0 && numinarrshift < ShiftsArray.length - 1) {
                r = moment(ShiftsArray[numinarrshift - 1].StartShift.format("YYYY-MM-DD"));//shift before
                YomBa = r.day();
                yom = TellMeTheDay(YomBa);//get day of shift before
                r = ShiftsArray[numinarrshift - 1].StartShift.format('DD/MM/YYYY');//get date of shift before
                mispar = ShiftsArray[numinarrshift - 1].NuminOfficialShift.length;
                embed = 0;
                embed = HowManyEmbed(numinarrshift - 1, mispar);
                st = yom + " " + ShiftsArray[numinarrshift - 1].Type + " " + r + " <br /> משובצים: " + embed + "/" + ShiftsArray[numinarrshift - 1].Guidenum;
                $("#before").html(st);
                ShiftA = moment(ShiftsArray[numinarrshift + 1].StartShift.format("YYYY-MM-DD"));//shift after
                YomBaA = ShiftA.day();
                yomA = TellMeTheDay(YomBaA);//get day of shift After
                ShiftA = ShiftsArray[numinarrshift + 1].StartShift.format('DD/MM/YYYY');//get date of shift after
                mispar = ShiftsArray[numinarrshift + 1].NuminOfficialShift.length;
                embedA = 0;
                embedA = HowManyEmbed(numinarrshift + 1, mispar);
                stA = yomA + " " + ShiftsArray[numinarrshift + 1].Type + " " + ShiftA + " <br /> משובצים: " + embedA + "/" + ShiftsArray[numinarrshift + 1].Guidenum;
                $("#after").html(stA);
            }
            else {
                //check if the shift is  the first in the array
                if (numinarrshift == 0) {
                    ShiftA = moment(ShiftsArray[numinarrshift + 1].StartShift.format("YYYY-MM-DD"));//shift after
                    YomBaA = ShiftA.day();
                    yomA = TellMeTheDay(YomBaA);//get day of shift After
                    ShiftA = ShiftsArray[numinarrshift + 1].StartShift.format('DD/MM/YYYY');//get date of shift after
                    mispar = ShiftsArray[numinarrshift + 1].NuminOfficialShift.length;
                    embedA = 0;
                    embedA = HowManyEmbed(numinarrshift + 1, mispar);
                    stA = yomA + " " + ShiftsArray[numinarrshift + 1].Type + " " + ShiftA + " <br /> משובצים: " + embedA + "/" + ShiftsArray[numinarrshift + 1].Guidenum;
                    $("#after").html(stA);
                }
                else if (numinarrshift == ((ShiftsArray.length) - 1)) {
                    r = moment(ShiftsArray[numinarrshift - 1].StartShift.format("YYYY-MM-DD"));//shift before
                    YomBa = r.day();
                    yom = TellMeTheDay(YomBa);//get day of shift before
                    r = ShiftsArray[numinarrshift - 1].StartShift.format('DD/MM/YYYY');//get date of shift before
                    mispar = ShiftsArray[numinarrshift - 1].NuminOfficialShift.length;
                    embed = HowManyEmbed(numinarrshift - 1, mispar);
                    st = yom + " " + ShiftsArray[numinarrshift - 1].Type + " " + r + " <br /> משובצים: " + embed + "/" + ShiftsArray[numinarrshift - 1].Guidenum;
                    $("#before").html(st);
                }
            }
            $('#ShiftsModal').modal("show");
        }
        function PutGuides(div, numinarrshift) {
            RedArr = [];
            ResonsArray = [];
            GreenArr = [];
            Eligible = true;
            Res = "";
            loop1:
            for (var j = 0; j < Guides.length; j++) {
                Eligible = true;
                ResonsArray = [];
                isApply = true;
                if (Guides[j].ShiftsSorted.length > 0) {
                    Guides[j].ShiftsSorted.sort(sortByDateAsc);
                    if (numinarrshift != 0) {
                        //checkes if the guide is work the shift before
                        loop2:
                        for (var l = 0; l < Guides[j].ShiftsSorted.length; l++) {
                            if (ShiftsArray[numinarrshift - 1].StartShift.format("YYYY-MM-DD") == Guides[j].ShiftsSorted[l].ShiftDate && ShiftsArray[numinarrshift - 1].Type == Guides[j].ShiftsSorted[l].ShiftType)
                                continue loop1;
                        }
                    }
                }
                for (var i = 0; i < calendar.length; i++) {
                    if (Guides[j].WeeklyHours[i] > HoursPerWeek)//  weekly hours
                    {
                        Res = {
                            "Emoji": "&#xf017;"
                        }
                        ResonsArray.push(Res);
                        Eligible = false;
                    }
                }
                if (Guides[j].MonthlyNormalHours > MonthNormalHours)  //monthly hours
                {
                    Res = {
                        "Emoji": "&#xf024;"
                    }
                    ResonsArray.push(Res);
                    Eligible = false;
                }
                if (Guides[j].MonthlyExtraHours > ExtraHours)//monthly  extra hours
                {
                    Res = {
                        "Emoji": "&#xf0fe;"
                    }
                    ResonsArray.push(Res);
                    Eligible = false;
                }
                for (var i = 0; i < GuidesPref.length; i++) {
                    Dd = GuidesPref[i].Shiftdate.split("T");
                    if (ShiftsArray[numinarrshift].StartShift.format("YYYY-MM-DD") == Dd[0] && ShiftsArray[numinarrshift].Type == GuidesPref[i].Shifttype && Guides[j].UserId == GuidesPref[i].Userid) {
                        if (GuidesPref[i].Isaplly1 == false) {
                            Res = {
                                "Emoji": "&#xf056;",
                            }
                            ResonsArray.push(Res);
                            Eligible = false;
                            isApply = false;
                        }
                    }
                }
                if (Eligible == true) {
                    GreenGuide = {
                        "UserName": Guides[j].Username,
                        "UserID": Guides[j].UserId,
                        "CountPref": Guides[j].CountPref,
                        "ExtraHours": Guides[j].MonthlyExtraHours
                    }
                    GreenArr.push(GreenGuide);
                }
                else if (Eligible == false) {
                    RedGuide = {
                        "UserName": Guides[j].Username,
                        "UserID": Guides[j].UserId,
                        "Reason": ResonsArray,
                        "IsApply": isApply,
                        "ExtraHours": Guides[j].MonthlyExtraHours
                    }
                    RedArr.push(RedGuide);
                }
            }
            fafa = "";
            SortRed = RedArr.sort(sortRedGuides);
            for (var r = 0; r < SortRed.length; r++) {
                fafa = "";
                for (var m = 0; m < SortRed[r].Reason.length; m++) {
                    fafa += SortRed[r].Reason[m].Emoji + " ";
                }
                document.getElementById("badGuids").innerHTML += "<option value='" + SortRed[r].UserID + "'>" + SortRed[r].UserName + "    " + fafa + " </option>";
            }
            SortGreen = GreenArr.sort(sortGreenGuides);
            for (var g = 0; g < SortGreen.length; g++) {
                document.getElementById("goodGuids").innerHTML += "<option value='" + SortGreen[g].UserID + "'>" + SortGreen[g].UserName + " </option>";
            }
        }
        sortGreenGuides = function (a, b) { return a.CountPref - b.CountPref || a.ExtraHours - b.ExtraHours };
        sortRedGuides = function (a, b) { return b.IsApply - a.IsApply || a.ExtraHours - b.ExtraHours };
        function InsertGuide(select, numinarrshift) {
            $("#realcomment").html(" ");
            var result = select.options[select.selectedIndex].text;
            userid = select.options[select.selectedIndex].value;
            resultStr = "<div id='div" + userid + "'  style='font-family: fontAwesome'><br />" + "<i class='fas fa-times' id='" + userid + "' onclick='DeleteDiv(" + userid + ")'></i>" + "  " + result + "   ";
            endHour = OfficialShifts[ShiftsArray[numinarrshift].NuminOfficialShift[0].NumInArray].Endshifthour;
            startHour = OfficialShifts[ShiftsArray[numinarrshift].NuminOfficialShift[0].NumInArray].Startshifthour;
            resultStr += "<input type='time' value='" + endHour + "'  id='" + userid + "E'/>" + "  -  " + "<input type='time' value='" + startHour + "' id='" + userid + "S'/>" + "    " + "<button onclick='SaveUpdateshift(this," + userid + "," + numinarrshift + ")'>שבץ מדריך</button></div>";
            classstr = $(select).parent().parent().prop('className');
            document.getElementsByClassName(classstr)[0].innerHTML += resultStr;
            for (var i = 0; i < GuidesPref.length; i++) {
                if (GuidesPref[i].Userid == userid && GuidesPref[i].Shifttype == ShiftsArray[numinarrshift].Type && GuidesPref[i].Comment != "") {
                    dateinguidepref = GuidesPref[i].Shiftdate.split("T");
                    console.log(dateinguidepref, ShiftsArray[numinarrshift].StartShift.format("YYYY-MM-DD"));
                    if (dateinguidepref[0] == ShiftsArray[numinarrshift].StartShift.format("YYYY-MM-DD")) {
                        $("#realcomment").html(result + " " + GuidesPref[i].Comment);
                        break;
                    }
                }
            }
        }
        function HowManyEmbed(NuminArr, len) {
            embed = 0;
            for (var i = 0; i < len; i++) {
                if (ShiftsArray[NuminArr].NuminOfficialShift[i].Occupied == true && OfficialShifts[ShiftsArray[NuminArr].NuminOfficialShift[i].NumInArray].Userid != "666666666" && OfficialShifts[ShiftsArray[NuminArr].NuminOfficialShift[i].NumInArray].Userid != "777777777" && OfficialShifts[ShiftsArray[NuminArr].NuminOfficialShift[i].NumInArray].Userid != "888888888" && OfficialShifts[ShiftsArray[NuminArr].NuminOfficialShift[i].NumInArray].Userid != "999999999")
                    embed++;
            }
            return embed;
        }
        function SaveUpdateshift(x, id, num) {
            Command = x.textContent;
            mispar = ShiftsArray[num].NuminOfficialShift.length;
            rf = $(x).parent().parent().prop('className');
            ShiftDuration = 0;
            RealShiboz = false;
            StratH = $("#" + id + "S").val();
            endHour = $("#" + id + "E").val();
            ShiftinWeeekNum = 0;
            for (var i = 0; i < calendar.length; i++) {
                range = moment().range(calendar[i].start.format("YYYY-MM-DD"), calendar[i].end.format("YYYY-MM-DD"));
                date = moment(ShiftsArray[num].StartShift.format("YYYY-MM-DD"));
                if (range.contains(date))
                    ShiftinWeeekNum = i;
            }
            Mstart = moment(StratH, 'HH:mm A');
            Mend = moment(endHour, 'HH:mm A');
            milisecond = moment.duration(Mend.diff(Mstart));
            ShiftDuration = milisecond.asHours();
            if (ShiftDuration < 0) {
                ShiftDuration = 24 + ShiftDuration;
            }
            if (x.textContent == 'שבץ מדריך') {
                for (var i = 0; i < mispar; i++) {
                    if (OfficialShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].Userid.toString().length == 1 || OfficialShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].Userid == false && ShiftsArray[num].NuminOfficialShift[i].Occupied == false) {
                        RealShiboz = true;
                        OfficialShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].Userid = id;
                        OfficialShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].Startshifthour = StratH;
                        OfficialShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].Endshifthour = endHour;
                        ShiftsArray[num].NuminOfficialShift[i].Occupied = true;
                        x.textContent = 'מחק מדריך';
                        x.id = "deleteguidebutton";
                        $("#" + id).remove();
                        StratH = $("#" + id + "S").val();
                        endHour = $("#" + id + "E").val();
                        $("#" + id + "S").prop("disabled", true);
                        $("#" + id + "E").prop("disabled", true);
                        embedA = HowManyEmbed(num, mispar);
                        if (embedA == mispar && RealShiboz == true) {
                            document.getElementById(rf).style.backgroundColor = "#CCFFCC";
                            document.getElementById(rf).innerHTML += "<i class='fa fa-thumbs-up' style='font-size:36px; margin:auto'></i>";
                            $("#ChoosenShift").html(" ");
                            $('#ShiftsModal').modal('hide');
                        }
                        Mstart = moment(StratH, 'HH:mm A');
                        Mend = moment(endHour, 'HH:mm A');
                        milisecond = moment.duration(Mend.diff(Mstart));
                        ShiftDuration = milisecond.asHours();
                        if (ShiftDuration < 0) {
                            ShiftDuration = 24 + ShiftDuration;
                        }
                        console.log(ShiftDuration);
                        if (ShiftDuration > LongerShift) {
                            swal("שים לב, משך המשמרת גדול מ" + LongerShift + " שעות", "", "warning");
                        }
                        break;
                    }
                }
                if (RealShiboz == false) {
                    swal("שים לב, המשמרת מאויישת במלואה", " במידה והנך רוצה לשנות שיבוץ יש למחוק קודם את מדריך מאוייש ולאחר מכן לשבץ שוב", "warning");
                    return null;

                }
            }
            else if (x.textContent == 'מחק מדריך') {
                x.textContent = 'שבץ מדריך';
                x.id = " ";
                $("#div" + id).prepend("<i class='fas fa-times' id='" + id + "' onclick='DeleteDiv(" + id + ")'></i>");
                $("#" + id + "S").prop("disabled", false);
                $("#" + id + "E").prop("disabled", false);
                for (var i = 0; i < mispar; i++) {
                    if (OfficialShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].Userid == id && ShiftsArray[num].NuminOfficialShift[i].Occupied == true) {
                        //Delete guide's shift from ShiftArray
                        console.log(id, OfficialShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].Userid);
                        ShiftsArray[num].NuminOfficialShift[i].Occupied = false;
                        //Delete guide's shift from OficialShift
                        OfficialShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].Userid = " ";
                        // Check if there are shifts saved on server
                        OfficialShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].idBefore = SaveShifts[ShiftsArray[num].NuminOfficialShift[i].NumInArray].Userid;
                        break;
                    }
                }
                embedA = HowManyEmbed(num, mispar);
                if (embedA != mispar) {
                    document.getElementById(rf).style.backgroundColor = "aliceblue";
                    if (document.getElementById(rf).childNodes.length > 1)
                        document.getElementById(rf).childNodes[1].remove()
                }
                if (id == "666666666" || id == "777777777" || id == "888888888" || id == "999999999")
                    document.getElementById(id + "embed" + rf).remove();
                info = rf.split("|");
                for (var j = 0; j < Exceptions.length; j++) {
                    if (Exceptions[j].User == id && Exceptions[j].ShiftDate == info[0] && Exceptions[j].ShiftType == info[1])
                        Exceptions.splice(j, 1);
                }
            }
            dateShift = OfficialShifts[ShiftsArray[num].NuminOfficialShift[0].NumInArray].Shiftdate;
            type = OfficialShifts[ShiftsArray[num].NuminOfficialShift[0].NumInArray].Shifttype;
            for (var i = 0; i < Guides.length; i++) {
                if (Guides[i].UserId == id) {
                    if (Command == 'מחק מדריך') {
                        for (var f = 0; f < Guides[i].ShiftsSorted.length; f++) {
                            if (Guides[i].ShiftsSorted[f].ShiftDate == dateShift && Guides[i].ShiftsSorted[f].ShiftType == type) {
                                Guides[i].ShiftsSorted.splice(f, 1);
                                break;
                            }
                        }
                        document.getElementById(Guides[i].UserId + "embed" + rf).remove();
                        if (Preperness == true && type == "לילה") {
                            if (ShiftDuration > SNightShiftHours) {
                                Guides[i].MonthlyNormalHours = Guides[i].MonthlyNormalHours - SNightShiftHours;
                                Guides[i].MonthlyExtraHours = Guides[i].MonthlyExtraHours - ShiftDuration + SNightShiftHours;
                                Guides[i].WeeklyHours[ShiftinWeeekNum] = Guides[i].WeeklyHours[ShiftinWeeekNum] - ShiftDuration;
                                UpdateExtra(Guides[i].Username, Guides[i].MonthlyExtraHours, Guides[i].UserId);
                            }
                            else {
                                Guides[i].MonthlyNormalHours = Guides[i].MonthlyNormalHours - ShiftDuration;
                                Guides[i].WeeklyHours[ShiftinWeeekNum] = Guides[i].WeeklyHours[ShiftinWeeekNum] - ShiftDuration;
                            }
                        }
                        else {
                            if (ShiftDuration > Regularshifthours) {
                                Guides[i].MonthlyNormalHours = Guides[i].MonthlyNormalHours - Regularshifthours;
                                Guides[i].MonthlyExtraHours = Guides[i].MonthlyExtraHours - ShiftDuration + Regularshifthours;
                                Guides[i].WeeklyHours[ShiftinWeeekNum] = Guides[i].WeeklyHours[ShiftinWeeekNum] - ShiftDuration;
                                UpdateExtra(Guides[i].Username, Guides[i].MonthlyExtraHours, Guides[i].UserId);
                            }
                            else {
                                Guides[i].MonthlyNormalHours = Guides[i].MonthlyNormalHours - ShiftDuration;
                                Guides[i].WeeklyHours[ShiftinWeeekNum] = Guides[i].WeeklyHours[ShiftinWeeekNum] - ShiftDuration;
                            }
                        }
                    }
                    else if (Command == 'שבץ מדריך' && RealShiboz == true) {
                        shiftdatetime = dateShift + " " + StratH;
                        Hathala = moment(shiftdatetime);
                        shiftend = dateShift + " " + endHour;
                        sium = moment(shiftend);
                        GuideShiftR = {
                            "ShiftDate": dateShift,
                            "ShiftType": type,
                            "StartShift": Hathala,
                            "EndHour": sium
                        }
                        Guides[i].ShiftsSorted.push(GuideShiftR);
                        document.getElementById(rf).childNodes[0].innerHTML += "<span id='" + Guides[i].UserId + "embed" + rf + "' class='row' style='margin:auto'>" + Guides[i].Username + "</span>";
                        if (Preperness == true && type == "לילה") {
                            if (ShiftDuration > SNightShiftHours) {
                                Guides[i].MonthlyNormalHours = Guides[i].MonthlyNormalHours + SNightShiftHours;
                                Guides[i].MonthlyExtraHours = Guides[i].MonthlyExtraHours + ShiftDuration - SNightShiftHours;
                                Guides[i].WeeklyHours[ShiftinWeeekNum] = Guides[i].WeeklyHours[ShiftinWeeekNum] + ShiftDuration;
                                UpdateExtra(Guides[i].Username, Guides[i].MonthlyExtraHours, Guides[i].UserId);
                            }
                            else {
                                Guides[i].MonthlyNormalHours = Guides[i].MonthlyNormalHours + ShiftDuration;
                                Guides[i].WeeklyHours[ShiftinWeeekNum] = Guides[i].WeeklyHours[ShiftinWeeekNum] + ShiftDuration;
                            }
                        }
                        else {
                            if (ShiftDuration > Regularshifthours) {
                                Guides[i].MonthlyNormalHours = Guides[i].MonthlyNormalHours + Regularshifthours;
                                Guides[i].MonthlyExtraHours = Guides[i].MonthlyExtraHours + ShiftDuration - Regularshifthours;
                                Guides[i].WeeklyHours[ShiftinWeeekNum] = Guides[i].WeeklyHours[ShiftinWeeekNum] + ShiftDuration;
                                UpdateExtra(Guides[i].Username, Guides[i].MonthlyExtraHours, Guides[i].UserId);
                            }
                            else {
                                Guides[i].MonthlyNormalHours = Guides[i].MonthlyNormalHours + ShiftDuration;
                                Guides[i].WeeklyHours[ShiftinWeeekNum] = Guides[i].WeeklyHours[ShiftinWeeekNum] + ShiftDuration;
                            }
                        }
                        if (Guides[i].MonthlyNormalHours > MonthNormalHours)// monthly normal hours
                        {
                            swal("שים לב, שעות העבודה החודשיות עולות על " + MonthNormalHours + " שעות", "", "warning");

                            Excpt = {
                                "User": Guides[i].UserId,
                                "Unit": Unitid,
                                "Index": "חריגה ממספר שעות עבודה חודשיות",
                                "ShiftType": type,
                                "ShiftDate": dateShift
                            }
                            Exceptions.push(Excpt);
                        }
                        if (Guides[i].MonthlyExtraHours > ExtraHours)//monthly extra hours
                        {
                            swal("שים לב, שעות העבודה הנוספות החודשיות עולות על " + ExtraHours + " שעות", "", "warning");
                             Excpt = {
                                "User": Guides[i].UserId,
                                "Unit": Unitid,
                                "Index": "חריגה ממספר שעות עבודה נוספות חודשיות",
                                "ShiftType": type,
                                "ShiftDate": dateShift
                            }
                            Exceptions.push(Excpt);
                        }
                        for (var w = 0; w < Guides[i].WeeklyHours.length; w++) {
                            if (Guides[i].WeeklyHours[w] > HoursPerWeek)// weekly hours
                            {
                                   swal("שים לב, שעות העבודה השבועיות עולות על " + HoursPerWeek + " שעות", "", "warning");
                                Excpt = {
                                    "User": Guides[i].UserId,
                                    "Unit": Unitid,
                                    "Index": "חריגה משעות עבודה שבועיות",
                                    "ShiftType": type,
                                    "ShiftDate": dateShift
                                }
                                Exceptions.push(Excpt);
                            }
                        }
                        break;
                    }
                }
            }
        }
        function newNumber(x) {
            x = x.toString();
            dfg = "";
            for (var i = 0; i < 9; i++) {
                dfg += x
            }
            return dfg;
        }

        function PostWorkArrangment() {
            for (var g = 0; g < Guides.length; g++) {
                if (Guides[g].ShiftsSorted.length > 0)
                    Guides[g].ShiftsSorted.sort(sortByDateAsc);
            }
            place = 0;
            for (var j = 0; j < Guides.length; j++) {
                if (Guides[j].ShiftsSorted.length > 0) {
                    HasABreak = false;
                    for (var f = 0; f < Guides[j].ShiftsSorted.length; f++) {
                        FirstShift = 0;
                        Lastshift = 0
                        if (f == 0) {
                            for (var i = 0; i < calendar.length; i++) {
                                range = moment().range(calendar[i].start.format("YYYY-MM-DD"), calendar[i].end.format("YYYY-MM-DD"));
                                date = moment(Guides[j].ShiftsSorted[f].StartShift.format("YYYY-MM-DD"));
                                if (range.contains(date)) {
                                    FirstShift = moment(calendar[i].start.format("YYYY-MM-DD") + ' ' + '00:00');
                                    Lastshift = moment(calendar[i].end.format("YYYY-MM-DD") + ' ' + '23:59');
                                }
                            }

                            Roshmish = Guides[j].ShiftsSorted[f].StartShift;
                            milisecond = moment.duration(Roshmish.diff(FirstShift));
                            BreakShift = milisecond.asHours();
                            if (BreakShift >= MaxRestHours) {
                                HasABreak = true;
                                place = f;
                            }
                        }
                        if (f == Guides[j].ShiftsSorted.length - 1 && HasABreak == false) {
                            Sofmish = Guides[j].ShiftsSorted[f].EndHour;

                            milisecond = moment.duration(Lastshift.diff(Sofmish));
                            BreakShift = milisecond.asHours();
                            if (BreakShift >= MaxRestHours) {
                                HasABreak = true;
                                place = f;
                            }
                        }
                        if (f + 1 < Guides[j].ShiftsSorted.length && HasABreak == false) {
                            Roshmish = Guides[j].ShiftsSorted[f + 1].StartShift;
                            Sofmish = Guides[j].ShiftsSorted[f].EndHour;
                            milisecond = moment.duration(Roshmish.diff(Sofmish));
                            BreakShift = milisecond.asHours();
                            if (BreakShift >= MaxRestHours) {
                                HasABreak = true;
                                place = f;
                            }
                        }
                        if (CheckEightHours == true) {
                            if (f + 1 < Guides[j].ShiftsSorted.length) {
                                Roshmish1 = Guides[j].ShiftsSorted[f + 1].StartShift;
                                Sofmish1 = Guides[j].ShiftsSorted[f].EndHour;
                                milisecond1 = moment.duration(Roshmish1.diff(Sofmish1));
                                BreakShift1 = milisecond1.asHours();
                                if (BreakShift1 < HoursBetweenShifts) {
                                    Excpt = {
                                        "User": Guides[j].UserId,
                                        "Unit": Unitid,
                                        "Index": "חריגה ממספר השעות המותר בין משמרת למשמרת",
                                        "ShiftType": Guides[j].ShiftsSorted[f].ShiftType,
                                        "ShiftDate": Guides[j].ShiftsSorted[f].ShiftDate
                                    }
                                    Exceptions.push(Excpt);
                                }
                            }
                        }
                    }
                    if (HasABreak == false) {
                        Excpt = {
                            "User": Guides[j].UserId,
                            "Unit": Unitid,
                            "Index": "אי קבלת מנוחה שבועית",
                            "ShiftType": Guides[j].ShiftsSorted[place].ShiftType,
                            "ShiftDate": Guides[j].ShiftsSorted[place].ShiftDate
                        }
                        Exceptions.push(Excpt);
                    }
                }
            }
            tav = 6;
            for (var i = 0; i < OfficialShifts.length; i++) {
                if (OfficialShifts[i].Userid == " " && i == 0) {
                    OfficialShifts[i].Userid = newNumber(tav);
                    tav += 1
                    continue;
                }
                else if (OfficialShifts[i].Userid == " " && OfficialShifts[i].Shifttype != OfficialShifts[i - 1].Shifttype) {
                    tav = 6;
                    OfficialShifts[i].Userid = newNumber(tav);
                    tav += 1;
                    continue;
                }
                else if (OfficialShifts[i].Userid == " " && OfficialShifts[i].Shifttype == OfficialShifts[i - 1].Shifttype && OfficialShifts[i].Shiftdate == OfficialShifts[i - 1].Shiftdate) {
                    OfficialShifts[i].Userid = newNumber(tav);
                    tav += 1;
                    continue;
                }
                if (tav == 9) {
                    swal("למשמרת הכוללת 4 מדריכים ומעלה ניתן לא למלא עד 4 מדריכים! ", "אין להשאיר את משמרת " + OfficialShifts[i].Shiftdate + ", " + OfficialShifts[i].Shifttype + " לא מאויישת!", "warning");
                    tav = 6;
                }
            }
            console.log(OfficialShifts);
            if (again == true) {
                for (var i = 0; i < OfficialShifts.length; i++) {
                    if (OfficialShifts[i].Userid != "666666666" && OfficialShifts[i].Userid != "777777777" && OfficialShifts[i].Userid != "888888888" && OfficialShifts[i].Userid != "999999999") {
                        OfficialShift = {
                            "Userid": OfficialShifts[i].Userid,
                            "Startshifthour": OfficialShifts[i].Startshifthour,
                            "Endshifthour": OfficialShifts[i].Endshifthour,
                            "Unitid": OfficialShifts[i].Unitid,
                            "Shifttype": OfficialShifts[i].Shifttype,
                            "Shiftdate": OfficialShifts[i].Shiftdate
                        }
                        console.log(OfficialShift, OfficialShifts[i].idBefore)
                        ajaxCall("Put", "../api/Official/CheckHours?idbefore=" + OfficialShifts[i].idBefore, JSON.stringify(OfficialShift), succesPut, error);
                    }
                }
            }
            else {
                ajaxCall("POST", "../api/Official", JSON.stringify(OfficialShifts), PostShiftS, PostShiftE);
            }
            if (Exceptions.length != 0)
                ajaxCall("POST", "../api/Exception", JSON.stringify(Exceptions), PostExceptionS, PostExceptionE);
        }
        function PostExceptionS(data) {
            swal("החריגות עודכנו בהצלחה", "", "success");
        }
        function PostExceptionE(error) {
            swal("הייתה בעיה בעדכון החריגות", "", "warning");
            console.log(error);
        }
        function succesPut(data) {
            swal("המשמרות עודכנו בהצלחה", "", "success");
        }
        function error(error) {
            swal("הייתה בעיה בעדכון החריגות", "", "warning");
            console.log(error);
        }
        function PostShiftS(data) {
            swal("המשמרות עודכנו בהצלחה", "", "success");
        }
        function PostShiftE(error) {
            console.log(error);
        }
        function DeleteDiv(userid) {
            divstr = "div" + userid;
            $("#" + divstr).remove();
        }
        function UpdateExtra(name, hours, ID) {
            userDiv = $("#Extra" + ID);
            userDiv.html(name + ": " + hours.toFixed(2));
        }
        sortByDateAsc = function (lhs, rhs) { return lhs.StartShift > rhs.StartShift ? 1 : lhs.StartShift < rhs.StartShift ? -1 : 0 }
    </script>
    <title>בניית סידור עבודה</title>
</head>
<body dir="rtl" style="background-color:aliceblue" onload="GetSHifts()">
    <img src="../Photos/LOGO.PNG" />
    <div class="container-fluid" id="SubmShift">
        <h1>בניית סידור עבודה</h1><br />
        <div class="row" id="submitshift" dir="rtl">
            <div class="col-10">
                <div class="row">
                    <div class="col-2" id="0">
                        <label> א'</label>
                    </div>
                    <div class="col-2" id="1">
                        <label> ב'</label>
                    </div>
                    <div class="col-2" id="2">
                        <label> ג'</label>
                    </div>
                    <div class="col-2" id="3">
                        <label> ד'</label>
                    </div>
                    <div class="col-2" id="4">
                        <label> ה'</label>
                    </div>
                    <div class="col-2" id="5">
                        <label> ו'</label>
                    </div>
                </div>
            </div>
            <div class="col-2">
                <div class="row">
                    <div class="col-12" id="6">
                        <label> ש'</label>
                    </div>
                </div>
            </div>
        </div>
        <input type="button" value="הגש סידור עבודה" onclick=" PostWorkArrangment()" />
    </div>
    <div class="modal fade bd-example-modal-lg" id="ShiftsModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="background-color:aliceblue">
                <div class="modal-body" dir="rtl">
                    <div class="row">
                        <div class="col" id="icons">
                            <p>  מקרא</p>
                            <i class='far fa-clock'></i>חריגה משעות שבועיות<br />
                            <i class='fas fa-flag'></i> חריגה משעות חודשיות<br />
                            <i class='fas fa-plus-square'></i>  חריגה משעות נוספות חודשיות<br />
                            <i class='fas fa-minus-circle'></i> המדריך לא הגיש את המשמרת<br />
                        </div>

                        <div class="col">
                            <table>
                                <tr class="before">
                                    <td id="before">
                                    </td>
                                </tr>
                                <tr>
                                    <td id="ChoosenShift">
                                    </td>
                                <tr class="after">
                                    <td id="after">
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <br />
                        <br />

                    </div><div class="row" style="margin-top:10px;">
                        <div class="col" id="ExtraHours">
                        </div><br />
                        <div class="col" id="commens">
                            <br />
                            <p>  הערות המדריך למשמרת</p>
                            <br />
                            <section id="realcomment"></section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>